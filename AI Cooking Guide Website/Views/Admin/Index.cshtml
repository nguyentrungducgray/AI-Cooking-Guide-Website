@{
	Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<body>


		
		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>
			<!DOCTYPE html>
			<html lang="en">
			<head>
				<meta charset="UTF-8">
				<meta name="viewport" content="width=device-width, initial-scale=1.0">
				<title>Thêm Món Ăn</title>
				<link rel="stylesheet" href="styles.css"> <!-- Liên kết đến file CSS -->
			</head>
			<body>
				<div class="form-container">
					<h2>Thêm Món Ăn</h2>
                <form id="recipe-form" onsubmit="saveRecipe(event)">
                    <label for="name">Tên Món Ăn:</label>
                    <input type="text" id="name" required>

                    <label for="ingredients">Nguyên Liệu:</label>
                    <div id="ingredients-container">
                        <input type="text" name="ingredients" class="ingredient" required>
                        
                    </div>
                    <button type="button" onclick="addIngredient()">Thêm Nguyên Liệu</button>

                    <label for="description">Mô Tả:</label>
                    <input type="text" id="description" required>

                    <label for="steps">Các Bước Nấu:</label>
                    <div id="steps-container">
                        <input type="text" name="steps" class="step" required>
                    </div>
                    <button type="button" onclick="addStep()">Thêm Bước Nấu</button>

                    <label for="image">Chọn Ảnh:</label>
                    <input type="file" id="image" name="Image" accept="image/*" required>
                    <img id="imagePreview" style="display:none; max-width: 100%; margin-top: 10px;" alt="Image Preview" />

                    <button type="submit">Thêm Món Ăn</button>
                </form>

				</div>

				<div id="recipe-list"></div>

            <script>
                function addIngredient() {
                    const ingredientsContainer = document.getElementById('ingredients-container');
                    const inputWrapper = document.createElement('div');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.name = 'ingredients';
                    input.className = 'ingredient';

                    const deleteButton = document.createElement('button');
                    deleteButton.type = 'button';
                    deleteButton.textContent = 'Xóa';
                    deleteButton.onclick = function () {
                        ingredientsContainer.removeChild(inputWrapper); // Xóa nguyên liệu
                    };

                    inputWrapper.appendChild(input);
                    inputWrapper.appendChild(deleteButton);
                    ingredientsContainer.appendChild(inputWrapper);
                }

                function addStep() {
                    const stepsContainer = document.getElementById('steps-container');
                    const inputWrapper = document.createElement('div');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.name = 'steps';
                    input.className = 'step';

                    const deleteButton = document.createElement('button');
                    deleteButton.type = 'button';
                    deleteButton.textContent = 'Xóa';
                    deleteButton.onclick = function () {
                        stepsContainer.removeChild(inputWrapper); // Xóa bước nấu
                    };

                    inputWrapper.appendChild(input);
                    inputWrapper.appendChild(deleteButton);
                    stepsContainer.appendChild(inputWrapper);
                }

                async function saveRecipe(event) {
                    event.preventDefault(); // Ngăn chặn gửi form mặc định

                    // Kiểm tra các trường bắt buộc
                    const name = document.getElementById('name').value.trim();
                    const description = document.getElementById('description').value.trim();
                    const ingredients = Array.from(document.getElementsByClassName('ingredient')).map(input => input.value.trim());
                    const steps = Array.from(document.getElementsByClassName('step')).map(input => input.value.trim());
                    const imageInput = document.getElementById('image');
                    const image = imageInput.files[0];

                    // Kiểm tra nếu tên món ăn hoặc mô tả trống
                    if (!name) {
                        alert("Tên món ăn không được để trống.");
                        return;
                    }

                    if (!description) {
                        alert("Mô tả không được để trống.");
                        return;
                    }

                    // Kiểm tra danh sách nguyên liệu
                    if (ingredients.some(ingredient => !ingredient)) {
                        alert("Không được để trống nguyên liệu.");
                        return;
                    }

                    // Kiểm tra danh sách bước nấu
                    if (steps.some(step => !step)) {
                        alert("Không được để trống các bước nấu.");
                        return;
                    }

                    // Kiểm tra nếu ảnh chưa được chọn
                    if (!image) {
                        alert("Hãy chọn một ảnh.");
                        return;
                    }

                    // Gửi dữ liệu nếu tất cả các trường hợp lệ
                    const formData = new FormData(document.getElementById("recipe-form"));
                    formData.append('Name', name);
                    formData.append('Description', description);
                    formData.append('Ingredients', JSON.stringify(ingredients)); // Chuyển đổi danh sách thành chuỗi JSON
                    formData.append('Steps', JSON.stringify(steps)); // Chuyển đổi danh sách thành chuỗi JSON

                    const response = await fetch('https://localhost:7149/Admin/SaveRecipe', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        alert("Thêm món ăn thành công!");
                        location.reload();
                    } else {
                        const errorMessage = await response.text();
                        alert("Không thể lưu món ăn: " + errorMessage);
                    }
                }
            </script>



				<style>
					.hidden {
						display: none;
					}

					/* Các CSS khác ở đây (nếu cần) */
				</style>

			</body>
		</html>


	</main>
	<!-- MAIN -->


</body>

